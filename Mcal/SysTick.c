/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  SysTick.c
 *        \brief  SysTick Driver
 *
 *      \details  The Driver Provide SysTick Api
 *                
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Std_Types.h"
#include "Systick.h"
#include "Mcu_Hw.h"
#include "BITMATH.h"

/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/	

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/


void (*LED_ON_callback)(void);
void (*LED_OFF_callback)(void);

uint8 ON_Time=0;
uint8 OverFlow_ON=0;
uint8 ON=0;



uint8 OFF_Time=0;
uint8 OverFlow_OFF=0;
uint8 OFF=2;

/*****************************/



/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/

void SysTick_Init(void)
{
	/*DISABLE COUNTER*/
	CLEAR_BIT(SYSTICK_STCTRL_R,0);
	
	
	
//	SYSTICK_STRELOAD_R=15999999;

	/*USE SYSTCLK*/
	SET_BIT(SYSTICK_STCTRL_R,2);
	/*ENABLE INTERRUPT*/
	SET_BIT(SYSTICK_STCTRL_R,1);
	

	
	
	
}



void StartTimer(uint8 Copy_ON_Time,uint8 Copy_OFF_Time)
{

	ON_Time=Copy_ON_Time;
	OFF_Time=Copy_OFF_Time;


	
	SYSTICK_STRELOAD_R=15999999;
	SYSTICK_STCURRENT_R=0;

	/*ENABLE COUNTER*/
	SET_BIT(SYSTICK_STCTRL_R,0);

	/*SET ACTIVE STATUS OF INTERRUPT*/
//	SET_BIT(SYS_CTRL,11);

	
	
}





void Systick_EnableNotification( void (*LED_ON_Notification)(void),void (*LED_OFF_Notification)(void))
{
	LED_ON_callback=LED_ON_Notification;
	LED_OFF_callback=LED_OFF_Notification;
	
	
	
}


void SysTick_Handler (void)
{
	//clear flags
//	CLEAR_BIT(SYS_CTRL,11);

	
	if(ON_Time>OverFlow_ON && ON==0)
	{
		LED_ON_callback();
		OverFlow_ON++;
		ON=1;
	}
 else if(ON_Time>OverFlow_ON && ON==1)
	{
		if((++OverFlow_ON)==ON_Time)
		{
			OverFlow_ON=0;
			ON=2;
			OFF=0;
			
			
		}
			
	}

	if(OFF_Time>OverFlow_OFF && OFF==0)
	{
		LED_OFF_callback();
		OverFlow_OFF++;
		OFF=1;
	}
	
	else if(OFF_Time>OverFlow_OFF && OFF==1)
	{
		if((++OverFlow_OFF)==OFF_Time)
		{
			OverFlow_OFF=0;
			OFF=2;
			ON=0;
			
			
		}
			
	}	
		
	
	
}








/**********************************************************************************************************************
 *  END OF FILE: SysTick.c
 *********************************************************************************************************************/
